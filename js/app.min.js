'use strict';(function(){var b=1,c=3,d=[],f=!1,g=!!('localStorage'in window),h,j={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},k,l=document.querySelector('[role="status"]'),m=document.querySelector('main'),n=document.querySelectorAll('nav a'),o=function(y,z){g&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:y,completedLevels:d,completed:z,showNumbers:f}))},q=function(){g&&localStorage.removeItem('gamestate')},r=function(y){var z=h.createBufferSource();z.buffer=y,z.connect(h.destination),z.start(0)},s=function(y){var z=new XMLHttpRequest;z.open('GET',y.src,!0),z.responseType='arraybuffer',z.onload=function(){h.decodeAudioData(z.response,function(C){y.buffer=C},function(C){throw new Error(C)})},z.send()},t=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},u=function(y,z){var A=!1;return Array.prototype.forEach.call(z.querySelectorAll('.color.'+y),function(B){B.classList.remove('color'),A=!0}),A},v=function(y,z){l.className='',setTimeout(function(){l.innerHTML=y,l.className=z?z:'status'},100)},w=function(y,z){if('true'===y.target.getAttribute('aria-hidden')||l.classList.contains('next')||l.classList.contains('gameover'))return(l.classList.contains('next')||l.classList.contains('gameover'))&&l.querySelector('button').focus(),!1;y.preventDefault();var A=y.target.className,B=document.querySelector('.current.svg'),C=!1;return A&&B&&(y.target.setAttribute('aria-disabled','true'),B.classList.add(A),C=u(A,B),B.querySelectorAll('.current.svg .color').length?C?(v('<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+t(),'correct'),r(j.correct1.buffer),o(B.className)):(c-=1,0>=c?(v('<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover'),r(j.wrong.buffer),setTimeout(function(){r(j.gameover.buffer)},100),q()):(v('<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+t(),'wrong'),r(j.wrong.buffer),o(B.className))):(c+=1,v('<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x1F525;</button>','correct next'),r(z?null:j.correct2.buffer),o(B.className,!0))),!0},x=function(y){var z=Math.floor(Math.random()*svgs.length),A=y?y.completedLevels[y.completedLevels.length-1]:z,B=svgs[A];if(B){var C=document.createElement('div'),D=document.querySelector('.svg.current');if(C.className='svg new',C.innerHTML=B,m.appendChild(C),y||d.push(A),svgs.splice(A,1),D&&(D.classList.remove('current'),D.classList.add('done'),setTimeout(function(){m.removeChild(D)},600)),setTimeout(function(){C.classList.remove('new'),C.classList.add('current'),y&&y.guessedColors&&(C.className=y.guessedColors),o(C.className)},500),Array.prototype.forEach.call(n,function(F,G){f&&!F.textContent&&(F.textContent=G+1),setTimeout(function(){F.setAttribute('aria-disabled','false'),y&&y.guessedColors&&-1<y.guessedColors.indexOf(F.className)&&(F.setAttribute('aria-disabled','true'),u(F.className,C))},50*G)}),y&&y.completed){var E=y.guessedColors.split(' ')[y.guessedColors.split(' ').length-1];setTimeout(function(){w({target:document.querySelector('nav.colors .'+E),preventDefault:function preventDefault(){c-=1}},!0,!0)},600)}else v('<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+t()),r(j.newlevel.buffer)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,h=new AudioContext}catch(y){throw new Error('No Web Audio support')}Array.prototype.forEach.call(n,function(y){y.addEventListener('click',w,!1)}),document.addEventListener('click',function(y){y.target.classList.contains('startgame')&&(svgs&&svgs.length?x():v('<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover')),y.target.classList.contains('playagain')&&document.location.reload(),y.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,x()):(v('<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F4AB;</button>','correct gameover'),q()))}),document.addEventListener('keydown',function(y){if('Enter'===y.key){var z=document.querySelector('button:not([aria-disabled])');z&&(z.classList.contains('startgame')&&(f=!0),z.blur(),z.click())}if(!isNaN(y.key)&&0<y.key&&9>y.key){var A=n[y.key-1];A&&'true'!==A.getAttribute('aria-disabled')&&A.click()}}),s(j.correct1),s(j.correct2),s(j.wrong),s(j.newlevel),s(j.gameover),k=function p(){if(g){var y=JSON.parse(localStorage.getItem('gamestate'));if(y)return b=y.level,c=y.lives,d=y.completedLevels,f=y.showNumbers,y.completedLevels&&y.completedLevels.forEach(function(z,A){A!==y.completedLevels.length-1&&svgs.splice(z,1)}),y}return!1}(),k?(m.innerHTML='',x(k)):v('<div><h1>Color Heroes &#x1F4A5;</div>'+t())})();