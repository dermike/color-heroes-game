'use strict';(function(){var b=1,c=3,d=[],f=!!('localStorage'in window),g,h={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},j,k=document.querySelector('[role="status"]'),l=document.querySelector('main'),m=document.querySelectorAll('nav a'),n=function(x,y){f&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:x,completedLevels:d,completed:y}))},p=function(){f&&localStorage.removeItem('gamestate')},q=function(x){var y=g.createBufferSource();y.buffer=x,y.connect(g.destination),y.start(0)},r=function(x){var y=new XMLHttpRequest;y.open('GET',x.src,!0),y.responseType='arraybuffer',y.onload=function(){g.decodeAudioData(y.response,function(B){x.buffer=B},function(B){throw new Error(B)})},y.send()},s=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},t=function(x,y){var z=!1;return Array.prototype.forEach.call(y.querySelectorAll('.color.'+x),function(A){A.classList.remove('color'),z=!0}),z},u=function(x,y){k.className='',setTimeout(function(){k.innerHTML=x,k.className=y?y:'status'},100)},v=function(x,y){if('true'===x.target.getAttribute('aria-hidden')||k.classList.contains('next')||k.classList.contains('gameover'))return(k.classList.contains('next')||k.classList.contains('gameover'))&&k.querySelector('button').focus(),!1;x.preventDefault();var z=x.target.className,A=document.querySelector('.current.svg'),B=!1;return z&&A&&(x.target.setAttribute('aria-disabled','true'),A.classList.add(z),B=t(z,A),A.querySelectorAll('.current.svg .color').length?B?(u('<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+s(),'correct'),q(h.correct1.buffer),n(A.className)):(c-=1,0>=c?(u('<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover'),q(h.wrong.buffer),setTimeout(function(){q(h.gameover.buffer)},100),p()):(u('<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+s(),'wrong'),q(h.wrong.buffer),n(A.className))):(c+=1,u('<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x1F525;</button>','correct next'),q(y?null:h.correct2.buffer),n(A.className,!0))),!0},w=function(x){var y=Math.floor(Math.random()*svgs.length),z=x?x.completedLevels[x.completedLevels.length-1]:y,A=svgs[z];if(A){var B=document.createElement('div'),C=document.querySelector('.svg.current');if(B.className='svg new',B.innerHTML=A,l.appendChild(B),x||d.push(z),svgs.splice(z,1),C&&(C.classList.remove('current'),C.classList.add('done'),setTimeout(function(){l.removeChild(C)},600)),setTimeout(function(){B.classList.remove('new'),B.classList.add('current'),x&&x.guessedColors&&(B.className=x.guessedColors),n(B.className)},500),Array.prototype.forEach.call(m,function(E,F){setTimeout(function(){E.setAttribute('aria-disabled','false'),x&&x.guessedColors&&-1<x.guessedColors.indexOf(E.className)&&(E.setAttribute('aria-disabled','true'),t(E.className,B))},50*F)}),x&&x.completed){var D=x.guessedColors.split(' ')[x.guessedColors.split(' ').length-1];setTimeout(function(){v({target:document.querySelector('nav.colors .'+D),preventDefault:function preventDefault(){c-=1}},!0,!0)},600)}else u('<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+s()),q(h.newlevel.buffer)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,g=new AudioContext}catch(x){throw new Error('No Web Audio support')}Array.prototype.forEach.call(m,function(x){x.addEventListener('click',v,!1)}),document.addEventListener('click',function(x){x.target.classList.contains('startgame')&&(svgs&&svgs.length?w():u('<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover')),x.target.classList.contains('playagain')&&document.location.reload(),x.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,w()):(u('<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F4AB;</button>','correct gameover'),p()))}),r(h.correct1),r(h.correct2),r(h.wrong),r(h.newlevel),r(h.gameover),j=function o(){if(f){var x=JSON.parse(localStorage.getItem('gamestate'));if(x)return b=x.level,c=x.lives,d=x.completedLevels,x.completedLevels&&x.completedLevels.forEach(function(y,z){z!==x.completedLevels.length-1&&svgs.splice(y,1)}),x}return!1}(),j?(l.innerHTML='',w(j)):u('<div><h1>Color Heroes &#x1F4A5;</div>'+s())})();