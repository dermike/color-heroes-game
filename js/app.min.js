'use strict';(function(){var b=1,c=3,d=[],f=!!('localStorage'in window),g,h={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},j=function(w,x){f&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:w,completedLevels:d,completed:x}))},l=function(){f&&localStorage.removeItem('gamestate')},m=function(w){var x=g.createBufferSource();x.buffer=w,x.connect(g.destination),x.start(0)},n=function(w){var x=new XMLHttpRequest;x.open('GET',w.src,!0),x.responseType='arraybuffer',x.onload=function(){g.decodeAudioData(x.response,function(A){w.buffer=A},function(A){throw new Error(A)})},x.send()},o=function k(){if(f){var w=JSON.parse(localStorage.getItem('gamestate'));if(w)return b=w.level,c=w.lives,d=w.completedLevels,w.completedLevels&&w.completedLevels.forEach(function(x,y){y!==w.completedLevels.length-1&&svgs.splice(x,1)}),w}return!1}(),p=document.querySelector('[role="status"]'),q=document.querySelector('main'),r=document.querySelectorAll('nav a'),s=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},t=function(w,x){var y=!1;return Array.prototype.forEach.call(x.querySelectorAll('.color.'+w),function(z){z.classList.remove('color'),y=!0}),y},u=function(w){if('true'===w.target.getAttribute('aria-hidden')||p.classList.contains('next')||p.classList.contains('gameover'))return(p.classList.contains('next')||p.classList.contains('gameover'))&&p.querySelector('button').focus(),!1;w.preventDefault();var x=w.target.className,y=document.querySelector('.current.svg'),z=!1;return x&&y&&(p.className='',w.target.setAttribute('aria-disabled','true'),y.classList.add(x),z=t(x,y),setTimeout(function(){document.querySelectorAll('.current.svg .color').length?z?(p.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+s(),p.className='correct',m(h.correct1.buffer),j(y.className)):(c-=1,0>=c?(p.innerHTML='<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F504;</button>',p.className='wrong gameover',m(h.wrong.buffer),setTimeout(function(){m(h.gameover.buffer)},100),l()):(p.innerHTML='<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+s(),p.className='wrong',m(h.wrong.buffer),j(y.className))):(c+=1,p.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x27A1;&#xFE0F;</button>',p.className='correct next',m(h.correct2.buffer),j(y.className,!0))},100)),!0},v=function(w){var x=Math.floor(Math.random()*svgs.length),y=w?w.completedLevels[w.completedLevels.length-1]:x,z=svgs[y];if(z){var A=document.createElement('div'),B=document.querySelector('.svg.current');A.className='svg new',A.innerHTML=z,q.appendChild(A),w||d.push(y),svgs.splice(y,1),B&&(B.classList.remove('current'),B.classList.add('done'),setTimeout(function(){q.removeChild(B)},600)),setTimeout(function(){A.classList.remove('new'),A.classList.add('current'),w&&w.guessedColors&&(A.className=w.guessedColors),j(A.className)},500),Array.prototype.forEach.call(r,function(C,D){setTimeout(function(){C.setAttribute('aria-disabled','false'),w&&w.guessedColors&&-1<w.guessedColors.indexOf(C.className)&&(C.setAttribute('aria-disabled','true'),t(C.className,A))},50*D)}),p.className='',setTimeout(function(){if(w&&w.completed){var C=w.guessedColors.split(' ')[w.guessedColors.split(' ').length-1];setTimeout(function(){u({target:document.querySelector('nav.colors .'+C),preventDefault:function preventDefault(){c-=1}},!0)},600)}else p.className='status',p.innerHTML='<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+s(),m(h.newlevel.buffer)},100)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,g=new AudioContext}catch(w){throw new Error('No Web Audio support')}Array.prototype.forEach.call(r,function(w){w.addEventListener('click',u,!1)}),document.addEventListener('click',function(w){w.target.classList.contains('playagain')&&document.location.reload(),w.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,v()):(p.innerHTML='<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F504;</button>',p.className='correct gameover',l()))}),n(h.correct1),n(h.correct2),n(h.wrong),n(h.newlevel),n(h.gameover),svgs&&svgs.length?v(o):(p.innerHTML='<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F504;</button>',p.className='wrong gameover')})();