'use strict';(function(){var b=1,c=3,d=[],f=!!('localStorage'in window),g,h={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},j=function(v,w,x){f&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:w,completedLevels:d,currentSvg:v.innerHTML,completed:x}))},l=function(){f&&localStorage.removeItem('gamestate')},m=function(v){var w=g.createBufferSource();w.buffer=v,w.connect(g.destination),w.start(0)},n=function(v){var w=new XMLHttpRequest;w.open('GET',v.src,!0),w.responseType='arraybuffer',w.onload=function(){g.decodeAudioData(w.response,function(z){v.buffer=z},function(z){throw new Error(z)})},w.send()},o=function k(){if(f){var v=JSON.parse(localStorage.getItem('gamestate'));if(v)return b=v.level,c=v.lives,d=v.completedLevels,v.completedLevels&&v.completedLevels.forEach(function(w){svgs.splice(w,1)}),v}return!1}(),p=document.querySelector('[role="status"]'),q=document.querySelector('main'),r=document.querySelectorAll('nav a'),s=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},t=function(v){if('true'===v.target.getAttribute('aria-hidden')||p.classList.contains('next')||p.classList.contains('gameover'))return(p.classList.contains('next')||p.classList.contains('gameover'))&&p.querySelector('button').focus(),!1;v.preventDefault();var w=v.target.className,x=document.querySelector('.current.svg'),y=!1;return w&&x&&(p.className='',v.target.setAttribute('aria-disabled','true'),x.classList.add(w),Array.prototype.forEach.call(document.querySelectorAll('.current.svg .color.'+w),function(z){z.classList.remove('color'),y=!0}),setTimeout(function(){document.querySelectorAll('.current.svg .color').length?y?(p.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+s(),p.className='correct',m(h.correct1.buffer),j(x,x.className)):(c-=1,0>=c?(p.innerHTML='<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F504;</button>',p.className='wrong gameover',m(h.wrong.buffer),setTimeout(function(){m(h.gameover.buffer)},100),l()):(p.innerHTML='<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+s(),p.className='wrong',m(h.wrong.buffer),j(x,x.className))):(c+=1,p.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x27A1;&#xFE0F;</button>',p.className='correct next',m(h.correct2.buffer),j(x,x.className,!0))},100)),!0},u=function(v){var w=Math.floor(Math.random()*svgs.length),x=v?v.currentSvg:svgs[w];if(x){var y=document.createElement('div'),z=document.querySelector('.svg.current');y.className='svg new',y.innerHTML=x,q.appendChild(y),v||(d.push(w),svgs.splice(w,1)),z&&(z.classList.remove('current'),z.classList.add('done'),setTimeout(function(){q.removeChild(z)},600)),setTimeout(function(){y.classList.remove('new'),y.classList.add('current'),v&&v.guessedColors&&(y.className=v.guessedColors),j(y,y.className)},500),Array.prototype.forEach.call(r,function(A,B){setTimeout(function(){A.setAttribute('aria-disabled','false'),v&&v.guessedColors&&-1<v.guessedColors.indexOf(A.className)&&A.setAttribute('aria-disabled','true')},50*B)}),p.className='',setTimeout(function(){if(v&&v.completed){var A=v.guessedColors.split(' ')[v.guessedColors.split(' ').length-1];setTimeout(function(){t({target:document.querySelector('nav.colors .'+A),preventDefault:function preventDefault(){c-=1}},!0)},600)}else p.className='status',p.innerHTML='<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+s(),m(h.newlevel.buffer)},100)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,g=new AudioContext}catch(v){throw new Error('Sound loading failed')}Array.prototype.forEach.call(r,function(v){v.addEventListener('click',t,!1)}),document.addEventListener('click',function(v){v.target.classList.contains('playagain')&&document.location.reload(),v.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,u()):(p.innerHTML='<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F504;</button>',p.className='correct gameover',l()))}),n(h.correct1),n(h.correct2),n(h.wrong),n(h.newlevel),n(h.gameover),svgs&&svgs.length?u(o):(p.innerHTML='<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F504;</button>',p.className='wrong gameover')})();