'use strict';(function(){var b=1,c=3,d=[],f=!1,g=!!('localStorage'in window),h,j={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},k,l=!1,m=document.querySelector('[role="status"]'),n=document.querySelector('main'),o=document.querySelectorAll('nav a'),p=function(z,A){g&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:z,completedLevels:d,completed:A,showNumbers:f}))},r=function(){g&&localStorage.removeItem('gamestate')},s=function(z){var A=h.createBufferSource();A.buffer=z,A.connect(h.destination),A.start(0)},t=function(z){var A=new XMLHttpRequest;A.open('GET',z.src,!0),A.responseType='arraybuffer',A.onload=function(){h.decodeAudioData(A.response,function(D){z.buffer=D},function(D){throw new Error(D)})},A.send()},u=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},v=function(z,A){var B=!1;return Array.prototype.forEach.call(A.querySelectorAll('.color.'+z),function(C){C.classList.remove('color'),B=!0}),B},w=function(z,A){m.className='',setTimeout(function(){m.innerHTML=z,m.className=A?A:'status'},100)},x=function(z,A){if('true'===z.target.getAttribute('aria-hidden')||m.classList.contains('next')||m.classList.contains('gameover'))return(m.classList.contains('next')||m.classList.contains('gameover'))&&m.querySelector('button').focus(),!1;z.preventDefault();var B=z.target.className,C=document.querySelector('.current.svg'),D=!1;return B&&C&&(z.target.setAttribute('aria-disabled','true'),C.classList.add(B),D=v(B,C),C.querySelectorAll('.current.svg .color').length?D?(w('<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+u(),'correct'),s(j.correct1.buffer),p(C.className)):(c-=1,0>=c?(w('<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover'),s(j.wrong.buffer),setTimeout(function(){s(j.gameover.buffer)},100),r()):(w('<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+u(),'wrong'),s(j.wrong.buffer),p(C.className))):(c+=1,w('<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x1F525;</button>','correct next'),s(A?null:j.correct2.buffer),p(C.className,!0))),!0},y=function(z){var A=Math.floor(Math.random()*svgs.length),B=z?z.completedLevels[z.completedLevels.length-1]:A,C=svgs[B];if(C){var D=document.createElement('div'),E=document.querySelector('.svg.current');if(D.className='svg new',D.innerHTML=C,n.appendChild(D),z||d.push(B),svgs.splice(B,1),E&&(E.classList.remove('current'),E.classList.add('done'),setTimeout(function(){n.removeChild(E)},600)),setTimeout(function(){D.classList.remove('new'),D.classList.add('current'),z&&z.guessedColors&&(D.className=z.guessedColors),p(D.className)},500),Array.prototype.forEach.call(o,function(G,H){f&&!G.textContent&&(G.textContent=H+1),setTimeout(function(){G.setAttribute('aria-disabled','false'),z&&z.guessedColors&&-1<z.guessedColors.indexOf(G.className)&&(G.setAttribute('aria-disabled','true'),v(G.className,D))},50*H)}),z&&z.completed){var F=z.guessedColors.split(' ')[z.guessedColors.split(' ').length-1];setTimeout(function(){x({target:document.querySelector('nav.colors .'+F),preventDefault:function preventDefault(){c-=1}},!0,!0)},600)}else w('<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+u()),s(j.newlevel.buffer)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,h=new AudioContext}catch(z){throw new Error('No Web Audio support')}Array.prototype.forEach.call(o,function(z){z.addEventListener('click',x,!1)}),document.addEventListener('click',function(z){z.target.classList.contains('startgame')&&(svgs&&svgs.length?y():w('<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F4AB;</button>','wrong gameover')),z.target.classList.contains('playagain')&&document.location.reload(),z.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,y()):(w('<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F4AB;</button>','correct gameover'),r()))}),document.addEventListener('keydown',function(z){if(l)return!1;if(l=!0,'Enter'===z.key){var A=document.querySelector('button:not([aria-disabled])');A&&(A.classList.contains('startgame')&&(f=!0),A.blur(),A.click())}if(!isNaN(z.key)&&0<z.key&&9>z.key){var B=o[z.key-1];B&&'true'!==B.getAttribute('aria-disabled')&&B.click()}}),document.addEventListener('keyup',function(){l=!1}),t(j.correct1),t(j.correct2),t(j.wrong),t(j.newlevel),t(j.gameover),k=function q(){if(g){var z=JSON.parse(localStorage.getItem('gamestate'));if(z)return b=z.level,c=z.lives,d=z.completedLevels,f=z.showNumbers,z.completedLevels&&z.completedLevels.forEach(function(A,B){B!==z.completedLevels.length-1&&svgs.splice(A,1)}),z}return!1}(),k?(n.innerHTML='',y(k)):w('<div><h1>Color Heroes &#x1F4A5;</div>'+u())})();