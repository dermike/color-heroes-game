'use strict';(function(){var b=1,c=3,d=[],f=!!('localStorage'in window),g,h={correct1:{src:'sounds/correct1.m4a'},correct2:{src:'sounds/correct2.m4a'},wrong:{src:'sounds/wrong.m4a'},newlevel:{src:'sounds/newlevel.m4a'},gameover:{src:'sounds/gameover.m4a'}},j,k=document.querySelector('[role="status"]'),l=document.querySelector('main'),m=document.querySelectorAll('nav a'),n=function(w,x){f&&localStorage.setItem('gamestate',JSON.stringify({level:b,lives:c,guessedColors:w,completedLevels:d,completed:x}))},p=function(){f&&localStorage.removeItem('gamestate')},q=function(w){var x=g.createBufferSource();x.buffer=w,x.connect(g.destination),x.start(0)},r=function(w){var x=new XMLHttpRequest;x.open('GET',w.src,!0),x.responseType='arraybuffer',x.onload=function(){g.decodeAudioData(x.response,function(A){w.buffer=A},function(A){throw new Error(A)})},x.send()},s=function(){return'<button aria-disabled="true">'+c+' &#x2764;&#xFE0F;</button>'},t=function(w,x){var y=!1;return Array.prototype.forEach.call(x.querySelectorAll('.color.'+w),function(z){z.classList.remove('color'),y=!0}),y},u=function(w,x){if('true'===w.target.getAttribute('aria-hidden')||k.classList.contains('next')||k.classList.contains('gameover'))return(k.classList.contains('next')||k.classList.contains('gameover'))&&k.querySelector('button').focus(),!1;w.preventDefault();var y=w.target.className,z=document.querySelector('.current.svg'),A=!1;return y&&z&&(k.className='',w.target.setAttribute('aria-disabled','true'),z.classList.add(y),A=t(y,z),setTimeout(function(){document.querySelectorAll('.current.svg .color').length?A?(k.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! Keep guessing!</p></div>'+s(),k.className='correct',q(h.correct1.buffer),n(z.className)):(c-=1,0>=c?(k.innerHTML='<div><h1>Game over!</h1><p>Level '+b+'</div><button class="playagain">Play again &#x1F4AB;</button>',k.className='wrong gameover',q(h.wrong.buffer),setTimeout(function(){q(h.gameover.buffer)},100),p()):(k.innerHTML='<div><h1>Level '+b+'</h1><p>Wrong! Try again!</p></div>'+s(),k.className='wrong',q(h.wrong.buffer),n(z.className))):(c+=1,k.innerHTML='<div><h1>Level '+b+'</h1><p>Correct! +1 &#x2764;&#xFE0F;</p></div><button class="nextlevel">Next level &#x1F525;</button>',k.className='correct next',q(x?null:h.correct2.buffer),n(z.className,!0))},100)),!0},v=function(w){var x=Math.floor(Math.random()*svgs.length),y=w?w.completedLevels[w.completedLevels.length-1]:x,z=svgs[y];if(z){var A=document.createElement('div'),B=document.querySelector('.svg.current');A.className='svg new',A.innerHTML=z,l.appendChild(A),w||d.push(y),svgs.splice(y,1),B&&(B.classList.remove('current'),B.classList.add('done'),setTimeout(function(){l.removeChild(B)},600)),setTimeout(function(){A.classList.remove('new'),A.classList.add('current'),w&&w.guessedColors&&(A.className=w.guessedColors),n(A.className)},500),Array.prototype.forEach.call(m,function(C,D){setTimeout(function(){C.setAttribute('aria-disabled','false'),w&&w.guessedColors&&-1<w.guessedColors.indexOf(C.className)&&(C.setAttribute('aria-disabled','true'),t(C.className,A))},50*D)}),k.className='',setTimeout(function(){if(w&&w.completed){var C=w.guessedColors.split(' ')[w.guessedColors.split(' ').length-1];setTimeout(function(){u({target:document.querySelector('nav.colors .'+C),preventDefault:function preventDefault(){c-=1}},!0,!0)},600)}else k.className='status',k.innerHTML='<div><h1>Level '+b+'</h1><p>Start guessing!</p></div>'+s(),q(h.newlevel.buffer)},100)}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,g=new AudioContext}catch(w){throw new Error('No Web Audio support')}Array.prototype.forEach.call(m,function(w){w.addEventListener('click',u,!1)}),document.addEventListener('click',function(w){w.target.classList.contains('startgame')&&(svgs&&svgs.length?v():(k.innerHTML='<div><h1>Something went wrong!</h1></div><button class="playagain">Play again &#x1F504;</button>',k.className='wrong gameover')),w.target.classList.contains('playagain')&&document.location.reload(),w.target.classList.contains('nextlevel')&&(svgs&&svgs.length?(b+=1,v()):(k.innerHTML='<div><h1>You made it!</h1><p>Good job!</p></div><button class="playagain">Play again &#x1F504;</button>',k.className='correct gameover',p()))}),r(h.correct1),r(h.correct2),r(h.wrong),r(h.newlevel),r(h.gameover),j=function o(){if(f){var w=JSON.parse(localStorage.getItem('gamestate'));if(w)return b=w.level,c=w.lives,d=w.completedLevels,w.completedLevels&&w.completedLevels.forEach(function(x,y){y!==w.completedLevels.length-1&&svgs.splice(x,1)}),w}return!1}(),j?v(j):setTimeout(function(){k.innerHTML='<div><h1>Color Heroes &#x1F4A5;</div>'+s(),k.className='status'},100)})();